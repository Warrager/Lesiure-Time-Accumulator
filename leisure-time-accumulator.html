
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Leisure Time Accumulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="leisure-time-accumulator.css" media="screen" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script type="text/javascript" src= "extra.js"> </script>
<script type="text/javascript" src='file:///C:/Users/x7/Documents/Programming/html-css-js/jquery-3.1.1.min.js'></script>
</head>
<body>

<div class= "container-fluid"> 
    <div id = "main">
        <h1> Leisure Time Accumulator </h1>

        <div class = "row">
            <form class = "col-xs-12 col-md-12">
                <button type = "button" class = "accumulator_button reset"> Reset </button>
                <button type = "button" class = "accumulator_button work"> Work </button>
                <button type = "button" class = "accumulator_button pause"> Pause </button>
                <button type = "button" class = "accumulator_button break"> Break </button>
                <button type = "button" class = "accumulator_button change-ratio"> Change Ratio </button>
            </form> 
        </div>   

        <div class = "row">
            <div class = "col-xs-12 col-md-4">
                <h3> Total Time Worked </h3>
                <h3 class = "counter work" id = "work_time"> 0:00:00 </h3>
            </div>

            <div class = "col-xs-12 col-md-4">
                <h3> Work to Leisure Ratio </h3>
                <form>
                    <input type = "text" class = "accumulator_input" id = "ratio-work"/>
                    <p> : </p>
                    <input type = "text" class = "accumulator_input" id = "ratio-break" />
                </form>
            </div>
            
            <form class = "col-xs-12 col-md-4">
                <h3> Break Allowance </h3>
                <h3 class = "counter break" id = "break_allowance">  </h3>
            </form>
        </div>

        <div class = "row">
            <form class = "col-xs-12 col-md-12" id = "bottom_toolbar">
                <button type = "button" class = "button alter work"> Alter Work </button>
                <button type = "button" class = "button alarm"> Alarm </button>
                <button type = "button" class = "button stopwatch"> Stopwatch </button>
                <button type = "button" class = "button timer"> Timer </button>
                <button type = "button" class = "button alter break"> Alter Break </button>
            </form>
        </div>

        <div class = "row">
            <form class = "col-xs-12 col-md-12">
                <form>
                    <h3> Alter Work / Break </h3>
                    <input type = "text" class = "alter hour"/>
                    <p> : </p>
                    <input type = "text" class = "alter minute"/>
                </form>
            </form>
        </div>

        <div class = "row">
            <div class = "col-xs-12 col-md-12">
                <button type = "button" class = "alter_1 work"> Work </button>
                <button type = "button" class = "alter_1 break"> Break</button>
            </div>
        </div>

        <div class = "row">
            <div class = "col-xs-12 col-md-12">
                <button type = "button" class = "alter_2 increase"> Increase </button>
                <button type = "button" class = "alter_2 decrease"> Decrease </button>
            </div>
        </div>

        <div class = "row">
            <div class = "col-xs-12 col-md-12">
                <form id = "timer_form">
                    <h3> Timer </h3>
                    <input type = "text" class = "timer hour"/>
                    <p> : </p>
                    <input type = "text" class = "timer minute"/>
                    <p> : </p>
                    <input type = "text" class = "timer second"/>
                </form>
            </div>
        </div>


        <div class = "row">
            <div class = "col-xs-12">
                <form>
                    <button type = "button" class = "timer_button start"> Start </button>
                    <button type = "button" class = "timer_button pause"> Pause </button>
                    <button type = "button" class = "timer_button stop"> Stop  </button>
                    <button type = "button" class = "timer_button clear"> Clear </button>
                </form>
            </div>
        </div>

        <div class = "row">
            <div class = "col-xs-12">
                <h3 id = "timer_display"> 0:00:00 </h3>
            </div>
        </div>


        <div class = "row">
            <div class = "col-xs-12">
                <h3 id = "notification"> </h3>
            </div>        
        </div>
    </div>
</div>
<script>

$('button').prop('disabled',false);
$('input').prop('disabled',false);

var counter = {"break": 0, "work": 0, "timer": 0},
    time_unit = ['hour','minute','second'],
    time_multiplier = [3600, 60, 1],
    ratio = 0,
    timer,
    accumulating = false,
    timer_running = false,
    alter = "";

var temp = parseInt(localStorage.getItem('break_total'));
if (!temp){
    $('#break_allowance').html("0:00:00");
}
else {
    $('#break_allowance').html(time_formatter(temp));
    counter["break"] = temp;
}

window.onbeforeunload = function() {
    localStorage.setItem('break_total', counter["break"]);
}



//Displays seconds in a hour:minute:second format
function increment_counter(counter_type, ratio){
    if (counter_type === "work") {
        counter["work"] += 1;
        counter["break"] += ratio;
       $('.counter.work').html(time_formatter(counter["work"]));
       $('.counter.break').html(time_formatter(Math.floor(counter["break"])));
    }
    else if (counter_type === "break") {
        counter["break"] -= 1;
        $('.counter.break').html(time_formatter(Math.floor(counter["break"])));
    }
}


//Work / Break allocator
$('.accumulator_button').click(function(){
    var button_type = $(this)[0].classList[1];
    $('.accumulator_button').prop('disabled',false);
    $('.accumulator_input').prop('disabled', false);

    if (accumulating){
        accumulating = false;
        clearInterval(accumulator);
    }

    //clearInterval(accumulator);
    if (button_type === "reset"){
        ratio = 0, counter["break"] = 0, counter["work"] = 0;
        localStorage.setItem('break_total', 0)
        $('.counter.break').html('0:00:00');
        $('.counter.work').html('0:00:00');     
        return;
    }
    if (button_type === "change-ratio"){
        ratio = 0;
        return;
    }
    if (button_type === 'pause'){
        $('.accumulator_input').prop('disabled', true);
        return;
    }
    //If the button pushed is work / break
    if (!ratio){
        var x  = parseInt($('#ratio-break').val()), y = parseInt($('#ratio-work').val());

        ratio =  x / y;
        if (ratio === 0 || isNaN(ratio) || !isFinite(ratio)){
            ratio = 0;
            return;
        }
    }

    accumulating = true;
    $(this).prop('disabled', true);
    $('.accumulator_input').prop('disabled', true);

    accumulator = setInterval(function() { 
        increment_counter(button_type, ratio) 
    },1000);
});


//Alter
$('.alter_1').click(function(){
    alter = $(this)[0].classList[1];    
});

$('.alter_2').click(function(){
    var seconds = 0;
    for (let x = 0; x < 2; x++){
        if ($('.alter.'+time_unit[x]).val()){
            seconds += parseInt($('.alter.'+time_unit[x]).val()) * time_multiplier[x];
        }
    }
    $(this)[0].classList[1] === "increase" ? counter[alter] += seconds : counter[alter]-= seconds;
    $('.counter.'+alter).html(time_formatter(counter[alter]));
});


//Timer
$('.timer_button').click(function(){
    var button_type = $(this)[0].classList[1];
    $('.timer_button.start').prop('disabled', false);
    //Timer Start
    if (button_type === "start"){
        timer_running = true;
        $('.timer_button.start').prop('disabled', true);
        for (let x = 0; x < 3; x++){
            if ($('.timer.'+time_unit[x]).val()){
                counter["timer"] += parseInt($('.timer.'+time_unit[x]).val()) * time_multiplier[x];
            }
        }
        timer = setInterval(function() { 
            $('#timer_display').html(time_formatter(counter["timer"]));
            counter["timer"] -= 1;
        },1000);
        return;
    }

    //Timer Pause
    if (timer_running){
        timer_running = false;
        clearInterval(timer);
    }
    //Timer Stop
    if (button_type !== "pause"){
        counter["timer"] = 0;
        $('#timer_display').html("0:00:00");

        //Timer Clear
        if (button_type === "clear"){
            var form = document.getElementById("timer_form");
        form.reset();
        }
    }
});



//Checks if inputted value is an int
var num_arr = ['1','2','3','4','5','6','7','8','9','0'];
$('input').on('input', function(){
    var input = $(this).val();
    if (input.length > 2){
        $(this).val(input.slice(input.length - 2));
    }
    for (var x = 0, y = input.length; x < y; x++){
        if (num_arr.indexOf(input[x]) === -1){
            $(this).val("");
        }
    }
});

</script>
</body>
</html>