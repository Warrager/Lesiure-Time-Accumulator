
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Leisure Time Accumulator</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="leisure-time-accumulator.css" media="screen" />
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script type="text/javascript" src= "extra.js"> </script>
<script type="text/javascript" src='file:///C:/Users/x7/Documents/Programming/html-css-js/jquery-3.1.1.min.js'></script>
</head>
<body>

<div class= "container-fluid"> 
    <div id = "main">
        <h1> Leisure Time Accumulator </h1>
        <form class = "col-xs-12 col-md-12">
            <button type = "button" class = "accumulator_button reset"> Reset </button>
            <button type = "button" class = "accumulator_button work"> Work </button>
            <button type = "button" class = "accumulator_button pause"> Pause </button>
            <button type = "button" class = "accumulator_button break"> Break </button>
            <button type = "button" class = "accumulator_button change-ratio"> Change Ratio </button>
        </form>   

        <div class = "row">
            <div class = "col-xs-12 col-md-4">
                <h3> Total Time Worked </h3>
                <h3 class = "counter work" id = "work_time"> 0:00:00 </h3>
            </div>

            <div class = "col-xs-12 col-md-4">
                <h3> Work to Leisure Ratio </h3>
                <form>
                    <input type = "text" class = "accumulator_input" id = "ratio-work"/>
                    <p> : </p>
                    <input type = "text" class = "accumulator_input" id = "ratio-break" />
                </form>
            </div>
            
            <form class = "col-xs-12 col-md-4">
                <h3> Break Allowance </h3>
                <h3 class = "counter break" id = "break_allowance">  </h3>
            </form>
        </div>

        <form class = "col-xs-12 col-md-12" id = "bottom_toolbar">
            <button type = "button" class = "second_bar" id = "alarm_tab"> Alarm </button>
            <button type = "button" class = "second_bar" id = "alter_tab"> Alter </button>
            <button type = "button" class = "second_bar" id = "stopwatch_tab"> Stopwatch </button>
            <button type = "button" class = "second_bar" id = "timer_tab"> Timer </button>
        </form>
            
        <div class = "invisible tab" id = "alter_div">
            <form class = "col-xs-12 col-md-12">
                <h3> Alter Work / Break </h3>
                <input type = "text" class = "alter_input hour"/>
                <p> : </p>
                <input type = "text" class = "alter_input minute"/>
            </form>

            <form class = "col-xs-12 col-md-12">
                <button type = "button" class = "alter_1 work"> Work </button>
                <button type = "button" class = "alter_1 break"> Break</button>
            </form>

            <form class = "col-xs-12 col-md-12">
                <button type = "button" class = "alter_2 increase"> Increase </button>
                <button type = "button" class = "alter_2 decrease"> Decrease </button>
            </form>
        </div>

        <div class = "invisible tab" id = "timer_div">
            <form class = "col-xs-12 col-md-12">
                <h3> Timer </h3>
                <input type = "text" class = "timer_input hour"/>
                <p> : </p>
                <input type = "text" class = "timer_input minute"/>
                <p> : </p>
                <input type = "text" class = "timer_input second"/>
            </form>

            <form class = "col-xs-12">
                <button type = "button" class = "timer_button start"> Start </button>
                <button type = "button" class = "timer_button pause"> Pause </button>
                <button type = "button" class = "timer_button stop"> Stop  </button>
                <button type = "button" class = "timer_button clear"> Clear </button>
            </form>

            <div class = "col-xs-12">
                <h3 id = "timer_display"> 0:00:00 </h3>
            </div>
        </div>

        <div class = "invisible tab" id = "stopwatch_div">
            <div class = "col-xs-12">
                <h3> Stopwatch </h3>
                <h3 id = "stopwatch_display"> 0:00:00 </h3>
            </div>
    
            <form class = "col-xs-12">
                <button type = "button" class = "stopwatch_button start"> Start </button>
                <button type = "button" class = "stopwatch_button pause"> Pause </button>
                <button type = "button" class = "stopwatch_button stop"> Stop </button>
                <button type = "button" class = "stopwatch_button lap_button"> Lap </button>
            </form>

            <div class = "col-xs-12">
                <div id = "laps">

                </div>
            </div>
        </div>

        <div class = "invisible tab" id = "alarm_div">
            <form class = "col-xs-12" id = "alarm_form">
                <h3> Alarm Clock </h3>
                <input type = "text" class = "alarm_input hour"/>
                <p> : </p>
                <input type = "text" class = "alarm_input minute"/>
            </form>

            <form class = "col-xs-12">
                <button type = "button" class = "alarm_button start"> Start </button>
                <button type = "button" class = "alarm_button stop"> Stop </button>
                <button type = "button" class = "alarm_button clear"> Clear </button>
            </form>
        </div>
        
        <div class = "col-xs-12">
            <h3 id = "notification"> </h3>
        </div>        
    </div>
</div>
<script>

$('button').prop('disabled',false);
$('input').prop('disabled',false);

var counter = {"break": 0, "work": 0, "timer": 0, "stopwatch": 0},
    countdown = {"accumulator" : "", "timer" : "", "stopwatch" : "", "alarm" : ""},
    active = {
        "accumulator" : false, 
        "timer" : false, 
        "stopwatch" : false, 
        "alarm" : false},
    time_unit = ['hour','minute','second'],
    time_multiplier = [3600, 60, 1],
    ratio = 0,
    last_tab = "",
    alter = "";

var temp = parseInt(localStorage.getItem('break_total'));
if (!temp){
    $('#break_allowance').html("0:00:00");
}
else {
    $('#break_allowance').html(time_formatter(temp));
    counter["break"] = temp;
}


window.onbeforeunload = function() {
    localStorage.setItem('break_total', counter["break"]);
}


//Displays seconds in a hour:minute:second format
function increment_counter(counter_type, ratio){
    if (counter_type === "work") {
        counter["work"] += 1;
        counter["break"] += ratio;
       $('.counter.work').html(time_formatter(counter["work"]));
       $('.counter.break').html(time_formatter(Math.floor(counter["break"])));
    }
    else if (counter_type === "break") {
        counter["break"] -= 1;
        $('.counter.break').html(time_formatter(Math.floor(counter["break"])));
    }
}


//Accumulator 
$('.accumulator_button').click(function(){
    var button_type = $(this)[0].classList[1];
    $('.accumulator_button').prop('disabled',false);
    $('.accumulator_input').prop('disabled', false);

    if (active["accumulator"]){
        active["accumulator"] = false;
        clearInterval(countdown["accumulator"]);
    }

    //Accumulator Reset
    if (button_type === "reset"){
        if (!confirm("Will reset all accumulated break time.")){
            return;
        }
        ratio = 0, counter["break"] = 0, counter["work"] = 0;
        localStorage.setItem('break_total', 0)
        $('.counter.break').html('0:00:00');
        $('.counter.work').html('0:00:00');  
        return;
    }
    //Accumulator Change-Ratio
    if (button_type === "change-ratio"){
        ratio = 0;
        return;
    }
    //Accumulator Pause
    if (button_type === 'pause'){
        $('.accumulator_input').prop('disabled', true);
        return;
    }
    //Accumulator Break / Work
    if (!ratio){
        var x  = parseInt($('#ratio-break').val()), y = parseInt($('#ratio-work').val());

        ratio =  x / y;
        if (ratio === 0 || isNaN(ratio) || !isFinite(ratio)){
            ratio = 0;
            return;
        }
    }
    active["accumulator"] = true;
    $(this).prop('disabled', true);
    $('.accumulator_input').prop('disabled', true);

    countdown["accumulator"] = setInterval(function() { 
        increment_counter(button_type, ratio) 
    },1000);
});


//Bottom_Bar
$('.second_bar').click(function(){
    
    $("#" + last_tab + '_div').addClass('invisible');
    var tab = ($(this).attr('id')).replace(/_tab/g, '');
    last_tab = tab;
    $("#" + tab + '_div').removeClass('invisible');
});


//Alter
$('.alter_1').click(function(){
    alter = $(this)[0].classList[1];    
});

$('.alter_2').click(function(){
    var seconds = 0;
    for (let x = 0; x < 2; x++){
        if ($('.alter_input.'+time_unit[x]).val()){
            seconds += parseInt($('.alter_input.'+time_unit[x]).val()) * time_multiplier[x];
        }
    }
    $(this)[0].classList[1] === "increase" ? counter[alter] += seconds : counter[alter]-= seconds;
    $('.counter.'+alter).html(time_formatter(counter[alter]));
});


//Timer
$('.timer_button').click(function(){
    var button_type = $(this)[0].classList[1];
    $('.timer_input').prop('disabled', true);
    $('.timer_button.start').prop('disabled', false);
    //Timer Start
    if (button_type === "start"){
        active["timer"] = true;
        $('.timer_button.start').prop('disabled', true);
        if (!counter["timer"]){
            for (let x = 0; x < 3; x++){
                if ($('.timer_input.'+time_unit[x]).val()){
                    counter["timer"] += parseInt($('.timer_input.'+time_unit[x]).val()) * time_multiplier[x];
                }
            }
        }
        $('#timer_display').html(time_formatter(counter["timer"]));
        countdown["timer"] = setInterval(function() { 
            counter["timer"] -= 1;
            $('#timer_display').html(time_formatter(counter["timer"]));
            
        },1000);
        return;
    }

    //Timer Pause
    if (active["timer"]){
        active["timer"] = false;
        clearInterval(countdown["timer"]);
        
    }
    //Timer Stop
    if (button_type !== "pause"){
        counter["timer"] = 0;
        $('#timer_display').html("0:00:00");
        $('.timer_input').prop('disabled', false);

        //Timer Clear
        if (button_type === "clear"){
            var form = document.getElementById("timer_form");
            form.reset();
        }
    }
});


//Stopwatch
$('.stopwatch_button').click(function(){
    var button_type = $(this)[0].classList[1];
    $('.stopwatch_button').prop('disabled', false);

    //Stopwatch Start
    if (button_type === "start"){
        active["stopwatch"] = true;
        $('.stopwatch_button.start').prop('disabled', true);
        stopwatch = setInterval(function() { 
            counter["stopwatch"] += 1;
            $('#stopwatch_display').html(time_formatter(counter["stopwatch"], true));       
        },100);
        return;
    }

    //Stopwatch Lap
    if (button_type === "lap_button"){
        if (!counter["stopwatch"]){
            return;
        }
        var lap = $("<p></p>", {
                "class" : "lap",
                text: time_formatter(counter["stopwatch"], true),
                });
        $('#laps').append(lap);
        return;
    }

    //Stopwatch Pause
    if (active["stopwatch"] === true){
        active["stopwatch"] = false;
        clearInterval(stopwatch);
    }

    //Stopwatch Stop
    if (button_type === "stop"){
        counter["stopwatch"] = 0;
        $('#stopwatch_display').html('0:00:00');
        $('#laps').empty();
    }
});


//Alarm
$('.alarm_input.hour').on('input', function(){
    if (parseInt($(this).val()) > 24){
        $(this).val("");
    }
});
$('.alarm_input.minute').on('input', function(){
    if (parseInt($(this).val()) > 59){
        $(this).val("");
    }
});

$('.alarm_button').click(function(){
    var button_type = $(this)[0].classList[1];
    $('.alarm_button.start').prop('disabled', false);
    $('.alarm_input').prop('disabled', false);
    
    //Alarm Start
    if (button_type === 'start'){
        var now = new Date(),
            future = new Date(),
            hours = parseInt($('.alarm_input.hour').val()),
            minutes = parseInt($('.alarm_input.minute').val());
        active["alarm"] = true;

        $('.alarm_input').prop('disabled', true);
        $('.alarm_button.start').prop('disabled', true);
        future.setHours(hours, minutes,0); 
        difference = future.getTime() - now.getTime();

        if (difference <= 0){
            future.setHours(hours + 24, minutes); 
            difference = future.getTime() - now.getTime();
        }
        $('#notification').append("<p> alarm active </p>");
        $('#notification').append("<p>" + future + "</p>");
        countdown["alarm"] = setTimeout(function(){
            active["alarm"] = false;
            $('.alarm_input').prop('disabled', false);
            $('.alarm_button.start').prop('disabled', false);
            alert ("Finished placeholder");
            $('#notification').empty();
        }, difference);
    }
    
    //Alarm Stop
    else if (button_type === "stop"){
        active["alarm"] = false;
        clearTimeout(countdown["alarm"]);
        $('#notification').empty();
    }

    //Alarm Clear 
    else if (button_type === "clear"){
        active["alarm"] = false;
        clearTimeout(countdown["alarm"]);
        $('#notification').empty();
        var form = document.getElementById("alarm_form");
        form.reset();        
    }
});


//Checks if inputted value is an int
var num_arr = ['1','2','3','4','5','6','7','8','9','0'];
$('input').on('input', function(){
    var input = $(this).val();
    if (input.length > 2){
        $(this).val(input.slice(input.length - 2));
    }
    for (var x = 0, y = input.length; x < y; x++){
        if (num_arr.indexOf(input[x]) === -1){
            $(this).val("");
        }
    }
});


</script>
</body>
</html>